
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<meta name="theme-color" content="#2E7D5E"/>
<meta name="description" content="Golfeados Golf Club - Tournament Manager"/>
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<meta name="apple-mobile-web-app-title" content="Golfeados"/>
<link rel="manifest" href="manifest.json"/>
<link rel="apple-touch-icon" href="Logo_Golfeados.png"/>
<title>Golfeados Â· Golf Club</title>

<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#F0F4F2;
  --bg2:#E8EEEB;
  --card:#FFFFFF;
  --cardL:#F5F9F7;
  --border:#D0DDD8;
  --border2:#B8CEC7;
  --green:#2E7D5E;
  --greenL:#3DA07A;
  --greenPale:#E8F5F0;
  --blue:#1A6B8A;
  --blueL:#2589AD;
  --bluePale:#E3F2F8;
  --teal:#0D7377;
  --text:#1A2E27;
  --text2:#3D5A50;
  --muted:#7A9A8E;
  --white:#FFFFFF;
  --red:#D32F2F;
  --redPale:#FFEBEE;
  --gold:#C49A00;
  --goldPale:#FFF8E1;
  --shadow:0 1px 6px rgba(46,125,94,0.08);
  --shadow-md:0 4px 16px rgba(46,125,94,0.12);
}
html,body{background:var(--bg);color:var(--text);font-family:'Trebuchet MS',sans-serif;min-height:100dvh;}
button{cursor:pointer;font-family:inherit;}
input,select,textarea{font-family:inherit;}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* â”€â”€ LOADING â”€â”€ */
#loading{position:fixed;inset:0;background:var(--white);display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px;z-index:999;}
.spin{width:36px;height:36px;border:3px solid var(--border);border-top-color:var(--green);border-radius:50%;animation:spin 0.8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}

/* â”€â”€ LOGIN â”€â”€ */
#loginScreen{min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:24px;
  background:linear-gradient(160deg,#E8F5F0 0%,#E3F2F8 50%,#F0F4F2 100%);}
.login-card{width:100%;max-width:380px;background:var(--white);border-radius:20px;border:1px solid var(--border);padding:40px 32px;box-shadow:var(--shadow-md);}
.login-logo{text-align:center;margin-bottom:28px;}
.login-logo img{width:90px;height:90px;object-fit:contain;}
.login-title{font-size:22px;font-weight:800;color:var(--green);font-family:Georgia,serif;letter-spacing:1px;margin-top:10px;}
.login-sub{font-size:11px;color:var(--muted);letter-spacing:3px;text-transform:uppercase;margin-top:3px;}
.field{margin-bottom:16px;}
.field label{font-size:11px;color:var(--text2);font-weight:700;letter-spacing:1px;text-transform:uppercase;display:block;margin-bottom:6px;}
.field input{width:100%;padding:11px 14px;background:var(--bg);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-size:15px;outline:none;transition:border-color 0.2s;}
.field input:focus{border-color:var(--green);background:var(--white);}
.btn-login{width:100%;padding:13px;border-radius:10px;border:none;background:var(--green);color:#fff;font-weight:700;font-size:16px;font-family:Georgia,serif;letter-spacing:1px;box-shadow:0 4px 14px rgba(46,125,94,0.3);transition:opacity 0.2s;margin-top:4px;}
.btn-login:disabled{opacity:0.6;cursor:not-allowed;}
.btn-link{background:none;border:none;color:var(--muted);font-size:13px;text-align:center;display:block;width:100%;margin-top:14px;}
.error-box{background:var(--redPale);border:1px solid #FFCDD2;border-radius:8px;padding:10px 14px;color:var(--red);font-size:13px;margin-bottom:12px;}
.login-footer{position:fixed;bottom:20px;left:0;right:0;text-align:center;color:var(--muted);font-size:11px;letter-spacing:2px;}

/* â”€â”€ HEADER â”€â”€ */
#header{background:var(--white);border-bottom:1px solid var(--border);padding:0 20px;display:flex;align-items:center;justify-content:space-between;height:56px;position:sticky;top:0;z-index:100;box-shadow:var(--shadow);}
.header-logo{display:flex;align-items:center;gap:10px;}
.header-logo img{width:38px;height:38px;object-fit:contain;}
.header-title{font-size:15px;font-weight:800;color:var(--green);font-family:Georgia,serif;letter-spacing:1px;}
.header-sub{font-size:9px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;}
.header-right{display:flex;align-items:center;gap:10px;}
.badge-admin{font-size:10px;color:var(--white);font-weight:700;letter-spacing:1px;background:var(--green);padding:3px 8px;border-radius:10px;}
.header-user{font-size:11px;color:var(--muted);max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.btn-logout{background:none;border:1px solid var(--border);border-radius:6px;color:var(--muted);padding:5px 10px;font-size:11px;}

/* â”€â”€ NAV â”€â”€ */
#nav{background:var(--white);border-bottom:1px solid var(--border);display:flex;padding:0 12px;overflow-x:auto;position:sticky;top:56px;z-index:99;}
#nav::-webkit-scrollbar{height:0;}
.nav-btn{padding:11px 14px;background:transparent;border:none;border-bottom:2px solid transparent;color:var(--muted);font-weight:400;font-size:13px;display:flex;align-items:center;gap:5px;white-space:nowrap;transition:all 0.15s;}
.nav-btn.active{border-bottom-color:var(--green);color:var(--green);font-weight:700;}

/* â”€â”€ CONTENT â”€â”€ */
#content{padding:20px;max-width:900px;margin:0 auto;padding-bottom:40px;}

/* â”€â”€ CARDS â”€â”€ */
.card{background:var(--white);border-radius:14px;border:1px solid var(--border);overflow:hidden;margin-bottom:16px;box-shadow:var(--shadow);}
.card-header{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:var(--cardL);}
.card-title{font-size:12px;font-weight:700;color:var(--green);letter-spacing:1px;text-transform:uppercase;}
.card-body{padding:20px;}

/* â”€â”€ HERO â”€â”€ */
.hero{background:linear-gradient(135deg,var(--green) 0%,var(--teal) 60%,var(--blue) 100%);border-radius:16px;padding:24px 28px;border:none;position:relative;overflow:hidden;margin-bottom:16px;box-shadow:var(--shadow-md);}
.hero::after{content:'';position:absolute;top:-40px;right:-40px;width:220px;height:220px;border-radius:50%;background:rgba(255,255,255,0.06);}
.hero-label{font-size:11px;color:rgba(255,255,255,0.75);font-weight:600;letter-spacing:2px;text-transform:uppercase;margin-bottom:6px;}
.hero-title{font-size:22px;font-weight:700;color:#fff;font-family:Georgia,serif;}
.hero-stats{display:flex;gap:24px;margin-top:16px;flex-wrap:wrap;}
.hero-stat label{font-size:10px;color:rgba(255,255,255,0.65);letter-spacing:1px;text-transform:uppercase;display:block;}
.hero-stat span{font-size:15px;font-weight:600;color:#fff;margin-top:2px;display:block;}

/* â”€â”€ AVATAR â”€â”€ */
.avatar{border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-family:Georgia,serif;flex-shrink:0;color:#fff;}

/* â”€â”€ BADGES â”€â”€ */
.badge{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;}
.badge::before{content:'';width:6px;height:6px;border-radius:50%;background:currentColor;flex-shrink:0;}
.badge-oficial{background:#E8F5E9;color:#2E7D32;}
.badge-validar{background:#FFF8E1;color:#F57F17;}
.badge-attest{background:#EDE7F6;color:#5E35B1;}
.badge-planificada{background:#E3F2FD;color:#1565C0;}
.badge-enjuego{background:#FBE9E7;color:#BF360C;}
.badge-activo{background:#E8F5E9;color:#2E7D32;}

/* â”€â”€ RANKING â”€â”€ */
.rank-row{display:grid;grid-template-columns:40px 1fr 50px 55px 50px;gap:8px;padding:12px 16px;border-bottom:1px solid var(--border);align-items:center;}
.rank-row.top{background:var(--greenPale);}
.rank-head{display:grid;grid-template-columns:40px 1fr 50px 55px 50px;gap:8px;padding:8px 16px;border-bottom:1px solid var(--border);background:var(--cardL);}
.rank-head span{font-size:10px;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:1px;}

/* â”€â”€ JORNADA CARD â”€â”€ */
.jornada-card{background:var(--white);border-radius:12px;border:1px solid var(--border);overflow:hidden;margin-bottom:10px;box-shadow:var(--shadow);}
.jornada-header{padding:14px 18px;cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none;transition:background 0.15s;}
.jornada-header:hover{background:var(--cardL);}
.jornada-body{padding:0 18px 18px;border-top:1px solid var(--border);}
.jornada-actions{display:flex;gap:8px;padding:12px 0;flex-wrap:wrap;}

/* â”€â”€ RESULT ROW â”€â”€ */
.result-row{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:10px;background:var(--cardL);margin-bottom:6px;border:1px solid var(--border);}

/* â”€â”€ FORM â”€â”€ */
.form-label{font-size:11px;color:var(--text2);font-weight:700;letter-spacing:1px;text-transform:uppercase;display:block;margin-bottom:6px;}
.form-input{width:100%;padding:10px 14px;background:var(--bg);border:1.5px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;outline:none;transition:border-color 0.2s;}
.form-input:focus{border-color:var(--green);background:var(--white);}
.form-select{padding:8px 12px;background:var(--bg);border:1.5px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;outline:none;transition:border-color 0.2s;}
.form-select:focus{border-color:var(--green);}
.form-check{accent-color:var(--green);width:16px;height:16px;}

/* â”€â”€ BUTTONS â”€â”€ */
.btn-green{padding:9px 18px;border-radius:8px;border:none;background:var(--green);color:#fff;font-weight:700;font-size:13px;box-shadow:0 2px 8px rgba(46,125,94,0.25);}
.btn-blue{padding:9px 18px;border-radius:8px;border:none;background:var(--blue);color:#fff;font-weight:700;font-size:13px;}
.btn-teal{padding:9px 18px;border-radius:8px;border:none;background:var(--teal);color:#fff;font-weight:700;font-size:13px;}
.btn-attest{padding:8px 18px;border-radius:8px;border:1px solid #9C27B0;background:#F3E5F5;color:#7B1FA2;font-weight:700;font-size:13px;}
.btn-approve{padding:8px 18px;border-radius:8px;border:none;background:#E8F5E9;color:#2E7D32;font-weight:700;font-size:13px;border:1px solid #A5D6A7;}
.btn-outline{padding:8px 18px;border-radius:8px;border:1px solid var(--border2);background:var(--white);color:var(--text2);font-weight:600;font-size:13px;}
.btn-danger{padding:6px 10px;border-radius:8px;border:1px solid #FFCDD2;background:var(--redPale);color:var(--red);font-size:12px;font-weight:600;}
.btn-save{width:100%;padding:14px;border-radius:12px;border:none;background:var(--green);color:#fff;font-weight:800;font-size:16px;font-family:Georgia,serif;letter-spacing:1px;box-shadow:0 4px 14px rgba(46,125,94,0.3);margin-top:8px;}
.btn-back{background:none;border:none;color:var(--muted);font-size:22px;padding:0 8px 0 0;}
/* keep btn-primary as alias */
.btn-primary{padding:9px 18px;border-radius:8px;border:none;background:var(--green);color:#fff;font-weight:700;font-size:13px;box-shadow:0 2px 8px rgba(46,125,94,0.2);}

/* â”€â”€ CARGAR â”€â”€ */
.cargar-row{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
.pts-box{width:50px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:18px;border:1.5px solid var(--border);}

/* â”€â”€ INFO / SUCCESS â”€â”€ */
.info-attest{background:var(--bluePale);border:1px solid #B3D9E8;border-radius:10px;padding:12px 16px;font-size:12px;color:var(--blue);margin-bottom:16px;}
.success-box{background:var(--greenPale);border:1px solid #A5D6A7;border-radius:14px;padding:32px;text-align:center;}

/* â”€â”€ TABLE â”€â”€ */
.breakdown-table{width:100%;border-collapse:collapse;font-size:12px;}
.breakdown-table td{padding:8px;border-top:1px solid var(--border);}

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.35);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px;}
.modal-box{background:var(--white);border-radius:16px;width:100%;max-width:460px;box-shadow:0 16px 48px rgba(0,0,0,0.2);overflow:hidden;max-height:90vh;overflow-y:auto;}
.modal-header{padding:18px 24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:var(--cardL);}
.modal-title{font-size:15px;font-weight:700;color:var(--green);}
.modal-body{padding:24px;}
.modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:flex-end;}

/* â”€â”€ UTILS â”€â”€ */
.flex{display:flex;}.flex-1{flex:1;}.gap-8{gap:8px;}.gap-12{gap:12px;}.gap-16{gap:16px;}
.items-center{align-items:center;}.justify-between{justify-content:space-between;}
.text-green{color:var(--green);}.text-muted{color:var(--muted);}.text-dark{color:var(--text);}
.font-bold{font-weight:700;}.font-georgia{font-family:Georgia,serif;}
.text-11{font-size:11px;}.text-12{font-size:12px;}.text-13{font-size:13px;}.text-14{font-size:14px;}.text-15{font-size:15px;}
.mb-8{margin-bottom:8px;}.mb-12{margin-bottom:12px;}.mb-16{margin-bottom:16px;}
.mt-8{margin-top:8px;}.mt-12{margin-top:12px;}.mt-16{margin-top:16px;}
.overflow-x{overflow-x:auto;}
.section-gap{margin-bottom:20px;}
</style>
</head>
<body>

<!-- LOADING -->
<div id="loading">
  <div class="spin"></div>
  <div style="font-size:12px;color:var(--muted);letter-spacing:2px;">CARGANDO...</div>
</div>

<!-- LOGIN -->
<div id="loginScreen" style="display:none;">
  <div class="login-card">
    <div class="login-logo">
      <img src="Logo_Golfeados.png" alt="Golfeados"/>
      <div class="login-title">GOLFEADOS</div>
      <div class="login-sub">Golf Club Â· Tournament Manager</div>
    </div>
    <div id="loginView">
      <div id="loginError" class="error-box" style="display:none;"></div>
      <div class="field"><label>Email</label><input type="email" id="loginEmail" placeholder="tu@email.com" autocomplete="email"/></div>
      <div class="field"><label>ContraseÃ±a</label><input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password"/></div>
      <button class="btn-login" id="loginBtn" onclick="handleLogin()">Entrar al Club</button>
      <button class="btn-link" onclick="showReset()">Â¿Olvidaste tu contraseÃ±a?</button>
    </div>
    <div id="resetView" style="display:none;">
      <div style="font-size:13px;color:var(--muted);margin-bottom:14px;">Ingresa tu email para recibir un enlace de recuperaciÃ³n.</div>
      <div id="resetError" class="error-box" style="display:none;"></div>
      <div id="resetSuccess" style="display:none;text-align:center;padding:20px 0;">
        <div style="font-size:40px;margin-bottom:10px;">ğŸ“§</div>
        <div style="color:var(--text);font-size:14px;">Email de recuperaciÃ³n enviado.</div>
      </div>
      <div id="resetForm">
        <div class="field"><label>Email</label><input type="email" id="resetEmail" placeholder="tu@email.com"/></div>
        <button class="btn-login" onclick="handleReset()">Enviar Email</button>
      </div>
      <button class="btn-link" onclick="showLogin()">â† Volver al login</button>
    </div>
  </div>
  <div class="login-footer">PLAY Â· RELAX Â· ENJOY Â· SINCE 2024</div>
</div>

<!-- APP -->
<div id="app" style="display:none;">
  <div id="header">
    <div class="header-logo">
      <img src="Logo_Golfeados.png" alt="Golfeados"/>
      <div>
        <div class="header-title">GOLFEADOS</div>
        <div class="header-sub">Golf Club</div>
      </div>
    </div>
    <div class="header-right">
      <span id="adminBadge" class="badge-admin" style="display:none;">ADMIN</span>
      <span id="headerUser" class="header-user"></span>
      <button class="btn-logout" onclick="handleLogout()">Salir</button>
    </div>
  </div>

  <div id="nav">
    <button class="nav-btn active" data-tab="dashboard" onclick="goTab('dashboard')">ğŸ  Inicio</button>
    <button class="nav-btn" data-tab="ranking" onclick="goTab('ranking')">ğŸ† Ranking</button>
    <button class="nav-btn" data-tab="jornadas" onclick="goTab('jornadas')">ğŸ“… Jornadas</button>
    <button class="nav-btn" data-tab="jugadores" onclick="goTab('jugadores')">ğŸ‘¤ Jugadores</button>
    <button class="nav-btn" data-tab="clubes" onclick="goTab('clubes')">ğŸŒï¸ Clubes</button>
  </div>

  <div id="content">
    <div id="tab-dashboard"></div>
    <div id="tab-ranking" style="display:none;"></div>
    <div id="tab-jornadas" style="display:none;"></div>
    <div id="tab-jugadores" style="display:none;"></div>
    <div id="tab-clubes" style="display:none;"></div>
    <div id="tab-cargar" style="display:none;"></div>
  </div>
</div>

<!-- MODAL JORNADA -->
<div id="modalJornada" class="modal-overlay" style="display:none;" onclick="closeModalJornada()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title" id="modalJornadaTitle">Nueva Jornada</div>
      <button onclick="closeModalJornada()" style="background:none;border:none;font-size:20px;color:var(--muted);cursor:pointer;">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="modalJornadaError" class="error-box" style="display:none;"></div>
      <div style="display:flex;flex-direction:column;gap:14px;">
        <div>
          <label class="form-label">Club / Sede *</label>
          <select class="form-select" id="jornadaClub" style="width:100%;"></select>
        </div>
        <div style="display:flex;gap:12px;">
          <div style="flex:1;">
            <label class="form-label">Fecha *</label>
            <input type="date" class="form-input" id="jornadaFecha"/>
          </div>
          <div style="width:100px;">
            <label class="form-label">Estado</label>
            <select class="form-select" id="jornadaEstado" style="width:100%;">
              <option value="Planificada">Planificada</option>
              <option value="En Juego">En Juego</option>
              <option value="Pendiente Attest">Pendiente Attest</option>
              <option value="Por Validar">Por Validar</option>
              <option value="Oficial">Oficial</option>
            </select>
          </div>
        </div>
        <div style="display:flex;gap:12px;">
          <div style="flex:1;">
            <label class="form-label">Tee Time</label>
            <input type="time" class="form-input" id="jornadaTeeTime"/>
          </div>
          <div style="flex:2;">
            <label class="form-label">Notas (opcional)</label>
            <input type="text" class="form-input" id="jornadaNotas" placeholder="Ej: Scramble, 18 hoyos..."/>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-outline" onclick="closeModalJornada()">Cancelar</button>
      <button class="btn-green" id="btnGuardarJornada" onclick="saveJornada()">Guardar Jornada</button>
    </div>
  </div>
</div>


<!-- MODAL CLUB -->
<div id="modalClub" class="modal-overlay" style="display:none;" onclick="closeModalClub()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title" id="modalClubTitle">Nuevo Club</div>
      <button onclick="closeModalClub()" style="background:none;border:none;font-size:20px;color:var(--muted);cursor:pointer;">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="modalClubError" class="error-box" style="display:none;"></div>
      <div style="display:flex;flex-direction:column;gap:14px;">
        <div><label class="form-label">Nombre del Club *</label><input class="form-input" id="clubNombre" placeholder="Ej: Izcaragua Country Club"/></div>
        <div><label class="form-label">Ciudad</label><input class="form-input" id="clubCiudad" placeholder="Ej: Caracas"/></div>
        <div style="display:flex;gap:12px;">
          <div style="width:80px;"><label class="form-label">Iniciales</label><input class="form-input" id="clubIniciales" placeholder="IC" maxlength="3"/></div>
          <div style="flex:1;"><label class="form-label">Color avatar</label>
            <select class="form-select" id="clubColor" style="width:100%;">
              <option value="#2E7D5E">Verde</option>
              <option value="#1A6B8A">Azul</option>
              <option value="#0D7377">Teal</option>
              <option value="#7B1FA2">Morado</option>
              <option value="#C49A00">Dorado</option>
              <option value="#D32F2F">Rojo</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-outline" onclick="closeModalClub()">Cancelar</button>
      <button class="btn-green" id="btnGuardarClub" onclick="saveClub()">Guardar Club</button>
    </div>
  </div>
</div>

<!-- MODAL JUGADOR EDIT -->
<div id="modalJugador" class="modal-overlay" style="display:none;" onclick="closeModalJugador()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title">Editar Jugador</div>
      <button onclick="closeModalJugador()" style="background:none;border:none;font-size:20px;color:var(--muted);cursor:pointer;">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="modalJugadorError" class="error-box" style="display:none;"></div>
      <div style="display:flex;flex-direction:column;gap:14px;">
        <div><label class="form-label">Nombre Completo *</label><input class="form-input" id="editNombre" placeholder="Nombre completo"/></div>
        <div style="display:flex;gap:12px;">
          <div style="flex:1;"><label class="form-label">Alias</label><input class="form-input" id="editAlias" placeholder="Alias o apodo"/></div>
          <div style="width:80px;"><label class="form-label">Iniciales</label><input class="form-input" id="editFoto" placeholder="DB" maxlength="2"/></div>
        </div>
        <div><label class="form-label">Handicap</label><input class="form-input" id="editHandicap" type="number" min="0" max="54" placeholder="0" style="width:100px;"/></div>
        <div>
          <label class="form-label">TelÃ©fono / WhatsApp</label>
          <div style="display:flex;gap:8px;align-items:center;">
            <select class="form-select" id="editPaisCodigo" style="width:110px;">
              <option value="+58">ğŸ‡»ğŸ‡ª +58</option>
              <option value="+1">ğŸ‡ºğŸ‡¸ +1</option>
              <option value="+34">ğŸ‡ªğŸ‡¸ +34</option>
              <option value="+52">ğŸ‡²ğŸ‡½ +52</option>
              <option value="+57">ğŸ‡¨ğŸ‡´ +57</option>
              <option value="+51">ğŸ‡µğŸ‡ª +51</option>
              <option value="+54">ğŸ‡¦ğŸ‡· +54</option>
              <option value="+56">ğŸ‡¨ğŸ‡± +56</option>
              <option value="+55">ğŸ‡§ğŸ‡· +55</option>
              <option value="+507">ğŸ‡µğŸ‡¦ +507</option>
            </select>
            <input class="form-input" id="editTelefono" type="tel" placeholder="4141234567" style="flex:1;" oninput="validarTelefono(this)"/>
          </div>
          <div id="telefonoHint" style="font-size:11px;color:var(--muted);margin-top:4px;">Solo nÃºmeros, sin espacios ni guiones. Ej: 4141234567</div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-outline" onclick="closeModalJugador()">Cancelar</button>
      <button class="btn-green" id="btnGuardarJugador" onclick="saveJugador()">Guardar</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey:            "AIzaSyCu98_7auFGd3nJJmYDRCM7KaM5OdtCBx4",
  authDomain:        "golfeados-660b3.firebaseapp.com",
  projectId:         "golfeados-660b3",
  storageBucket:     "golfeados-660b3.firebasestorage.app",
  messagingSenderId: "417996522021",
  appId:             "1:417996522021:web:67871e33758befec81f5cc"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.firestore();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESTADO GLOBAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let STATE = {
  user:null, profile:null,
  torneo:null, jugadores:[], jornadas:[], resultados:[], clubes:[],
  currentTab:'dashboard', cargarJornadaId:null,
  expandedJornada:null, chartInstance:null,
  editingJornadaId:null,
  unsubs:[]
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
auth.onAuthStateChanged(async user => {
  if (user) {
    STATE.user = user;
    const snap = await db.collection('users').doc(user.uid).get();
    if (snap.exists) { STATE.profile = snap.data(); }
    else {
      const p = {email:user.email, nombre:user.displayName||user.email, role:'jugador', jugador_id:null};
      await db.collection('users').doc(user.uid).set(p);
      STATE.profile = p;
    }
    showApp(); initListeners();
  } else {
    STATE.user=null; STATE.profile=null;
    stopListeners(); showLogin_();
  }
});

function showLogin_(){
  document.getElementById('loading').style.display='none';
  document.getElementById('loginScreen').style.display='flex';
  document.getElementById('app').style.display='none';
}
function showApp(){
  document.getElementById('loading').style.display='none';
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('app').style.display='block';
  document.getElementById('headerUser').textContent = STATE.profile?.nombre||STATE.user?.email||'';
  document.getElementById('adminBadge').style.display = STATE.profile?.role==='admin'?'inline':'none';
}
async function handleLogin(){
  const email=document.getElementById('loginEmail').value.trim();
  const pass=document.getElementById('loginPassword').value;
  const btn=document.getElementById('loginBtn');
  const err=document.getElementById('loginError');
  err.style.display='none'; btn.disabled=true; btn.textContent='Entrando...';
  try{ await auth.signInWithEmailAndPassword(email,pass); }
  catch(e){
    const m={'auth/user-not-found':'Usuario no encontrado.','auth/wrong-password':'ContraseÃ±a incorrecta.','auth/invalid-credential':'Email o contraseÃ±a incorrectos.','auth/too-many-requests':'Demasiados intentos.'};
    err.textContent=m[e.code]||'Error al iniciar sesiÃ³n.'; err.style.display='block';
  } finally{ btn.disabled=false; btn.textContent='Entrar al Club'; }
}
async function handleLogout(){ await auth.signOut(); }
async function handleReset(){
  const email=document.getElementById('resetEmail').value.trim();
  const err=document.getElementById('resetError'); err.style.display='none';
  try{
    await auth.sendPasswordResetEmail(email);
    document.getElementById('resetForm').style.display='none';
    document.getElementById('resetSuccess').style.display='block';
  }catch{ err.textContent='No se encontrÃ³ ese email.'; err.style.display='block'; }
}
function showReset(){ document.getElementById('loginView').style.display='none'; document.getElementById('resetView').style.display='block'; }
function showLogin(){ document.getElementById('loginView').style.display='block'; document.getElementById('resetView').style.display='none'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIRESTORE LISTENERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initListeners(){
  stopListeners();
  STATE.unsubs.push(db.collection('torneos').orderBy('creado','desc').limit(1)
    .onSnapshot(s=>{ STATE.torneo=s.empty?null:{id:s.docs[0].id,...s.docs[0].data()}; renderCurrentTab(); }));
  STATE.unsubs.push(db.collection('jugadores').orderBy('nombre')
    .onSnapshot(s=>{ STATE.jugadores=s.docs.map(d=>({id:d.id,...d.data()})); renderCurrentTab(); }));
  STATE.unsubs.push(db.collection('jornadas').orderBy('numero')
    .onSnapshot(s=>{ STATE.jornadas=s.docs.map(d=>({id:d.id,...d.data()})); renderCurrentTab(); }));
  STATE.unsubs.push(db.collection('resultados')
    .onSnapshot(s=>{ STATE.resultados=s.docs.map(d=>({id:d.id,...d.data()})); renderCurrentTab(); }));
  STATE.unsubs.push(db.collection('clubes').orderBy('nombre')
    .onSnapshot(s=>{ STATE.clubes=s.docs.map(d=>({id:d.id,...d.data()})); renderCurrentTab(); }));
}
function stopListeners(){ STATE.unsubs.forEach(u=>u()); STATE.unsubs=[]; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVEGACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goTab(tab){
  STATE.currentTab=tab; STATE.cargarJornadaId=null;
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.toggle('active',b.dataset.tab===tab));
  ['dashboard','ranking','jornadas','jugadores','clubes','cargar'].forEach(t=>
    document.getElementById('tab-'+t).style.display=t===tab?'block':'none');
  renderCurrentTab();
}
function goCargar(jornadaId){
  STATE.cargarJornadaId=jornadaId; STATE.currentTab='cargar';
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  ['dashboard','ranking','jornadas','jugadores','clubes'].forEach(t=>document.getElementById('tab-'+t).style.display='none');
  document.getElementById('tab-cargar').style.display='block';
  renderCargar();
}
function renderCurrentTab(){
  if(STATE.currentTab==='dashboard') renderDashboard();
  else if(STATE.currentTab==='ranking') renderRanking();
  else if(STATE.currentTab==='jornadas') renderJornadas();
  else if(STATE.currentTab==='jugadores') renderJugadores();
  else if(STATE.currentTab==='clubes') renderClubes();
  else if(STATE.currentTab==='cargar') renderCargar();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcRanking(){
  return STATE.jugadores.map(j=>{
    const mis=STATE.resultados.filter(r=>r.jugador_id===j.id);
    const ptsOf=mis.filter(r=>STATE.jornadas.find(jn=>jn.id===r.jornada_id)?.estado==='Oficial').reduce((a,r)=>a+(r.pts||0),0);
    const ptsT=mis.filter(r=>{const jn=STATE.jornadas.find(jn=>jn.id===r.jornada_id);return jn&&jn.estado!=='Planificada';}).reduce((a,r)=>a+(r.pts||0),0);
    const asist=mis.filter(r=>r.asistencia&&STATE.jornadas.find(jn=>jn.id===r.jornada_id)?.estado!=='Planificada').length;
    return{...j,ptsOf,ptsT,asist};
  }).sort((a,b)=>b.ptsT-a.ptsT).map((j,i)=>({...j,pos:i+1}));
}
function getPts(pos,asist){ if(!asist)return 0; if(pos===1)return 4; if(pos===2)return 3; if(pos===3)return 2; return 1; }
function avatarBg(pos){
  if(pos===1)return'#C49A00'; if(pos===2)return'#78909C'; if(pos===3)return'#8D6E63';
  return'var(--green)';
}
function medal(pos){
  if(pos===1)return'ğŸ¥‡'; if(pos===2)return'ğŸ¥ˆ'; if(pos===3)return'ğŸ¥‰';
  return`<span style="color:var(--muted);font-weight:700;font-size:14px;width:22px;display:inline-block;text-align:center;">${pos}</span>`;
}
function badgeHTML(estado){
  const m={'Oficial':'badge-oficial','Por Validar':'badge-validar','Pendiente Attest':'badge-attest','Planificada':'badge-planificada','En Juego':'badge-enjuego','Activo':'badge-activo'};
  return`<span class="badge ${m[estado]||'badge-planificada'}">${estado}</span>`;
}
function avatarHTML(foto,pos,size='md'){
  const bg=avatarBg(pos);
  const sz=size==='sm'?'32px;font-size:11px':size==='lg'?'42px;font-size:15px':'36px;font-size:13px';
  const shadow=pos===1?'box-shadow:0 0 0 3px rgba(196,154,0,0.25);':'';
  return`<div class="avatar" style="width:${sz};background:${bg};${shadow}">${foto||'?'}</div>`;
}
function fmtFecha(dateStr){
  if(!dateStr) return 'â€”';
  const d=new Date(dateStr+'T12:00:00');
  return d.toLocaleDateString('es-ES',{day:'numeric',month:'short',year:'numeric'});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard(){
  const el=document.getElementById('tab-dashboard');
  const rk=calcRanking();
  const top3=rk.slice(0,3); const top5=rk.slice(0,5);
  const jugadas=STATE.jornadas.filter(j=>j.estado!=='Planificada').length;
  const proxima=STATE.jornadas.find(j=>j.estado==='Planificada');
  const isAdmin=STATE.profile?.role==='admin';

  el.innerHTML=`
    <div class="hero">
      <div class="hero-label">Campeonato Activo</div>
      <div class="hero-title">${STATE.torneo?.nombre||'Sin torneo activo'}</div>
      <div class="hero-stats">
        <div class="hero-stat"><label>Jornadas Jugadas</label><span>${jugadas}/${STATE.torneo?.jornadas_total||'â€”'}</span></div>
        <div class="hero-stat"><label>Jugadores</label><span>${STATE.jugadores.length}</span></div>
        <div class="hero-stat"><label>PrÃ³xima Sede</label><span>${proxima?.sede||'â€”'}</span></div>
        <div class="hero-stat"><label>Estado</label><span>${badgeHTML(STATE.torneo?.estado||'Activo')}</span></div>
      </div>
    </div>

    <div class="card">
      <div class="card-header"><span class="card-title">ğŸ† Podio</span></div>
      <div style="padding:16px;">
        ${top3.map(j=>`
          <div class="result-row" style="margin-bottom:8px;">
            <span style="font-size:20px;">${medal(j.pos)}</span>
            ${avatarHTML(j.foto,j.pos)}
            <div class="flex-1">
              <div class="text-14 font-bold">${j.nombre}</div>
              <div class="text-11 text-muted">${j.asist} jornadas jugadas</div>
            </div>
            <div style="text-align:right;">
              <div style="font-size:20px;font-weight:800;color:${j.pos===1?'var(--gold)':'var(--text)'};">${j.ptsT}</div>
              <div class="text-10 text-muted">pts</div>
            </div>
          </div>`).join('')}
      </div>
    </div>

    <div class="card">
      <div class="card-header"><span class="card-title">ğŸ“Š Puntos Top 5</span></div>
      <div class="card-body"><canvas id="chartBar" height="140"></canvas></div>
    </div>

    ${isAdmin?`
    <div class="card">
      <div class="card-header"><span class="card-title">âš™ï¸ Admin</span></div>
      <div class="card-body" style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn-green" onclick="goTab('jugadores')">+ Jugador</button>
        <button class="btn-blue" onclick="openModalJornada()">+ Jornada</button>
        <button class="btn-outline" onclick="goTab('jornadas')">Ver Jornadas</button>
        ${STATE.jugadores.length===0?`<button class="btn-teal" onclick="seedDatos()">ğŸŒ± Cargar Datos Iniciales</button>`:''}
      </div>
      <div id="seedMsg" style="display:none;padding:10px 20px;font-size:13px;color:var(--green);"></div>
    </div>`:''}
  `;

  setTimeout(()=>{
    const ctx=document.getElementById('chartBar');
    if(!ctx)return;
    if(STATE.chartInstance){STATE.chartInstance.destroy();STATE.chartInstance=null;}
    const colors=['#C49A00','#78909C','#8D6E63','#2E7D5E','#1A6B8A'];
    STATE.chartInstance=new Chart(ctx,{
      type:'bar',
      data:{labels:top5.map(j=>j.alias||j.nombre.split(' ')[0]),
        datasets:[{data:top5.map(j=>j.ptsT),backgroundColor:colors,borderRadius:6,borderSkipped:false}]},
      options:{responsive:true,plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>` ${c.parsed.y} pts`}}},
        scales:{x:{ticks:{color:'#7A9A8E'},grid:{display:false}},y:{ticks:{color:'#7A9A8E'},grid:{color:'#D0DDD8'}}}}
    });
  },50);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANKING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRanking(){
  const el=document.getElementById('tab-ranking');
  const rk=calcRanking();
  const ofic=STATE.jornadas.filter(j=>j.estado==='Oficial');
  const jugadasAll=STATE.jornadas.filter(j=>j.estado!=='Planificada');

  el.innerHTML=`
    <div class="card">
      <div class="card-header"><span class="card-title">Tabla de Posiciones</span><span class="text-11 text-muted">${ofic.length} jornadas oficiales</span></div>
      <div class="rank-head"><span>#</span><span>Jugador</span><span>Ofic.</span><span>Total</span><span>Asist.</span></div>
      ${rk.map(j=>`
        <div class="rank-row ${j.pos<=3?'top':''}">
          <div>${medal(j.pos)}</div>
          <div class="flex items-center gap-8">${avatarHTML(j.foto,j.pos,'sm')}<div><div class="text-13 font-bold">${j.nombre}</div><div class="text-11 text-muted">${j.alias||''}</div></div></div>
          <div class="text-14 font-bold">${j.ptsOf}</div>
          <div style="font-size:15px;font-weight:800;color:${j.pos===1?'var(--gold)':'var(--text)'};">${j.ptsT}</div>
          <div class="text-13 text-muted">${j.asist}âœ“</div>
        </div>`).join('')}
    </div>

    <div class="card">
      <div class="card-header"><span class="card-title">Desglose por Jornada</span></div>
      <div class="card-body overflow-x" style="padding:12px;">
        <table class="breakdown-table">
          <tr>
            <td style="padding:6px 8px;color:var(--muted);font-weight:700;">Jugador</td>
            ${jugadasAll.map(jn=>`<td style="padding:6px 8px;text-align:center;color:var(--muted);font-weight:700;white-space:nowrap;">${jn.sede}<br/>${badgeHTML(jn.estado)}</td>`).join('')}
            <td style="padding:6px 8px;text-align:center;color:var(--green);font-weight:700;">TOTAL</td>
          </tr>
          ${rk.map(j=>`
            <tr>
              <td style="padding:8px;font-weight:600;white-space:nowrap;">${j.nombre}</td>
              ${jugadasAll.map(jn=>{const r=STATE.resultados.find(r=>r.jornada_id===jn.id&&r.jugador_id===j.id);const val=r?(r.asistencia?r.pts:'â€”'):'?';const col=r&&r.pts>=4?'var(--gold)':'var(--text)';return`<td style="padding:8px;text-align:center;color:${r?col:'var(--muted)'};">${val}</td>`;}).join('')}
              <td style="padding:8px;text-align:center;font-weight:800;color:${j.pos===1?'var(--gold)':'var(--text)'};">${j.ptsT}</td>
            </tr>`).join('')}
        </table>
      </div>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JORNADAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Helper: club avatar for jornada list
function clubAvatarHTML(sede){
  const cl=STATE.clubes.find(c=>c.nombre===sede);
  const bg=cl?.color||'#2E7D5E';
  const ini=cl?.iniciales||sede?.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,3)||'â›³';
  return`<div style="width:42px;height:42px;border-radius:10px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;color:#fff;background:${bg};">${ini}</div>`;
}

function renderJornadas(){
  const el=document.getElementById('tab-jornadas');
  const isAdmin=STATE.profile?.role==='admin';
  const jornadasOrdenadas=[...STATE.jornadas].sort((a,b)=>{
    if(!a.fecha)return 1;if(!b.fecha)return -1;
    return new Date(a.fecha)-new Date(b.fecha);
  });

  el.innerHTML=`
    ${isAdmin?`<div style="display:flex;justify-content:flex-end;margin-bottom:16px;">
      <button class="btn-green" onclick="openModalJornada()">+ Nueva Jornada</button>
    </div>`:''}
    ${jornadasOrdenadas.length===0?`<div class="card"><div class="card-body" style="text-align:center;color:var(--muted);padding:40px;">No hay jornadas creadas aÃºn.</div></div>`:''}
    ${jornadasOrdenadas.map(jn=>{
      const res=STATE.resultados.filter(r=>r.jornada_id===jn.id).sort((a,b)=>a.pos-b.pos);
      const isOpen=STATE.expandedJornada===jn.id;
      const cargador=STATE.jugadores.find(j=>j.id===jn.cargado_por);
      const attestador=STATE.jugadores.find(j=>j.id===jn.attest_por);
      const myJugadorId=STATE.profile?.jugador_id;
      const canAttest=jn.estado==='Pendiente Attest'&&jn.cargado_por!==myJugadorId&&STATE.resultados.some(r=>r.jornada_id===jn.id&&r.jugador_id===myJugadorId);

      return`
        <div class="jornada-card">
          <div class="jornada-header" onclick="toggleJornada('${jn.id}')">
            <div class="flex items-center gap-12">
              ${clubAvatarHTML(jn.sede)}
              <div>
                <div class="text-15 font-bold">${jn.sede||'Sin sede'}</div>
                <div class="text-12 text-muted">${fmtFecha(jn.fecha)}${jn.teeTime?' Â· â° '+jn.teeTime:''}${jn.notas?' Â· '+jn.notas:''}</div>
              </div>
            </div>
            <div class="flex items-center gap-8">
              ${badgeHTML(jn.estado)}
              ${isAdmin?`<button class="btn-outline" style="padding:4px 10px;font-size:12px;" onclick="event.stopPropagation();openModalJornada('${jn.id}')">âœï¸</button>`:''}
              <span style="color:var(--muted);font-size:13px;">${isOpen?'â–²':'â–¼'}</span>
            </div>
          </div>
          ${isOpen?`
            <div class="jornada-body">
              <div class="jornada-actions">
                ${(jn.estado==='Planificada'||jn.estado==='En Juego')?`<button class="btn-primary" onclick="goCargar('${jn.id}')">ğŸ“‹ Cargar Resultados</button>`:''}
                ${canAttest?`<button class="btn-attest" onclick="handleAttest('${jn.id}')">âœï¸ Attest (Confirmar)</button>`:''}
                ${isAdmin&&jn.estado==='Por Validar'?`<button class="btn-approve" onclick="handleAprobar('${jn.id}')">âœ… Aprobar Oficial</button>`:''}
                ${jn.estado!=='Planificada'?`<button class="btn-outline" onclick="goCargar('${jn.id}')">âœï¸ Editar resultados</button>`:''}
                ${isAdmin?`<button class="btn-danger" onclick="deleteJornada('${jn.id}')">ğŸ—‘ï¸ Eliminar</button>`:''}
              </div>
              ${res.length>0?`
                ${res.map(r=>{const jug=STATE.jugadores.find(j=>j.id===r.jugador_id);return`
                  <div class="result-row">
                    <span style="font-size:18px;">${medal(r.pos)}</span>
                    ${avatarHTML(jug?.foto||'?',r.pos,'sm')}
                    <div class="flex-1 text-13 font-bold">${jug?.nombre||'Desconocido'}</div>
                    <div class="text-11" style="color:${r.asistencia?'var(--muted)':'var(--red)'};">${r.asistencia?'JugÃ³':'No asistiÃ³'}</div>
                    <div style="font-size:16px;font-weight:800;color:${r.pos===1?'var(--gold)':'var(--text)'};">${r.pts}<span class="text-11 text-muted"> pts</span></div>
                  </div>`;}).join('')}
                <div style="margin-top:10px;padding:8px 12px;background:var(--cardL);border-radius:8px;font-size:11px;color:var(--muted);border:1px solid var(--border);">
                  ${cargador?`ğŸ“‹ Cargado por <strong style="color:var(--text);">${cargador.nombre}</strong>`:''}
                  ${attestador?` Â· âœï¸ Attest: <strong style="color:#7B1FA2;">${attestador.nombre}</strong>`:''}
                </div>`
              :`<div style="padding:20px 0;text-align:center;color:var(--muted);font-size:13px;">
                ${jn.estado==='Planificada'?'â³ Pendiente Â· Presiona "Cargar Resultados" al finalizar':'Sin resultados cargados'}
              </div>`}
            </div>`:``}
        </div>`;
    }).join('')}
  `;
}

function toggleJornada(id){ STATE.expandedJornada=STATE.expandedJornada===id?null:id; renderJornadas(); }

async function handleAttest(jornadaId){
  await db.collection('jornadas').doc(jornadaId).update({
    estado:'Por Validar', attest_por:STATE.profile?.jugador_id||STATE.user.uid,
    attest_at:firebase.firestore.FieldValue.serverTimestamp()
  });
}
async function handleAprobar(jornadaId){
  await db.collection('jornadas').doc(jornadaId).update({
    estado:'Oficial', aprobado_por:STATE.user.uid,
    aprobado_at:firebase.firestore.FieldValue.serverTimestamp()
  });
}
async function deleteJornada(id){
  if(!confirm('Â¿Eliminar esta jornada y sus resultados?'))return;
  const batch=db.batch();
  batch.delete(db.collection('jornadas').doc(id));
  STATE.resultados.filter(r=>r.jornada_id===id).forEach(r=>batch.delete(db.collection('resultados').doc(r.id)));
  await batch.commit();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL JORNADA â€” Crear / Editar
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModalJornada(jornadaId=null){
  STATE.editingJornadaId=jornadaId;
  const modal=document.getElementById('modalJornada');
  const title=document.getElementById('modalJornadaTitle');
  const err=document.getElementById('modalJornadaError');
  err.style.display='none';

  // Populate club select
  const sel=document.getElementById('jornadaClub');
  sel.innerHTML=`<option value="">â€” Selecciona un club â€”</option>`+
    STATE.clubes.map(c=>`<option value="${c.nombre}">${c.nombre}</option>`).join('');

  if(jornadaId){
    title.textContent='Editar Jornada';
    const jn=STATE.jornadas.find(j=>j.id===jornadaId);
    if(jn){
      document.getElementById('jornadaClub').value=jn.sede||'';
      document.getElementById('jornadaFecha').value=jn.fecha||'';
      document.getElementById('jornadaEstado').value=jn.estado||'Planificada';
      document.getElementById('jornadaNotas').value=jn.notas||'';
      document.getElementById('jornadaTeeTime').value=jn.teeTime||'';
    }
  } else {
    title.textContent='Nueva Jornada';
    document.getElementById('jornadaClub').value='';
    document.getElementById('jornadaFecha').value='';
    document.getElementById('jornadaEstado').value='Planificada';
    document.getElementById('jornadaNotas').value='';
    document.getElementById('jornadaTeeTime').value='';
  }
  modal.style.display='flex';
}

function closeModalJornada(event){
  if(event&&event.currentTarget!==event.target)return;
  document.getElementById('modalJornada').style.display='none';
  STATE.editingJornadaId=null;
}

async function saveJornada(){
  const club=document.getElementById('jornadaClub').value.trim();
  const fecha=document.getElementById('jornadaFecha').value;
  const estado=document.getElementById('jornadaEstado').value;
  const notas=document.getElementById('jornadaNotas').value.trim();
  const teeTime=document.getElementById('jornadaTeeTime').value;
  const err=document.getElementById('modalJornadaError');
  const btn=document.getElementById('btnGuardarJornada');
  err.style.display='none';

  if(!club){err.textContent='Selecciona un club.';err.style.display='block';return;}
  if(!fecha){err.textContent='La fecha es obligatoria.';err.style.display='block';return;}

  btn.disabled=true; btn.textContent='Guardando...';
  try{
    if(STATE.editingJornadaId){
      await db.collection('jornadas').doc(STATE.editingJornadaId).update({
        sede:club, fecha, estado, notas, teeTime,
        updated_at:firebase.firestore.FieldValue.serverTimestamp()
      });
    } else {
      const numero=(STATE.jornadas.length>0?Math.max(...STATE.jornadas.map(j=>j.numero||0)):0)+1;
      await db.collection('jornadas').add({
        numero, nombre:`J${numero}`, sede:club, fecha, estado, notas, teeTime,
        torneo_id:STATE.torneo?.id||'',
        creado:firebase.firestore.FieldValue.serverTimestamp()
      });
    }
    document.getElementById('modalJornada').style.display='none';
    STATE.editingJornadaId=null;
  } catch(e){
    err.textContent='Error al guardar: '+e.message; err.style.display='block';
  } finally{ btn.disabled=false; btn.textContent='Guardar Jornada'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLUBES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let editingClubId=null;

function renderClubes(){
  const el=document.getElementById('tab-clubes');
  const isAdmin=STATE.profile?.role==='admin';
  el.innerHTML=`
    ${isAdmin?`<div style="display:flex;justify-content:flex-end;margin-bottom:16px;">
      <button class="btn-green" onclick="openModalClub()">+ Agregar Club</button>
    </div>`:''}
    ${STATE.clubes.length===0?`<div class="card"><div class="card-body" style="text-align:center;color:var(--muted);padding:40px;">No hay clubes registrados.</div></div>`:''}
    <div style="display:flex;flex-direction:column;gap:10px;">
      ${STATE.clubes.map(club=>{
        const bg=club.color||'#2E7D5E';
        const ini=club.iniciales||club.nombre.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,3);
        return`
        <div class="card" style="margin-bottom:0;">
          <div style="padding:14px 18px;display:flex;align-items:center;gap:14px;">
            <div style="width:44px;height:44px;border-radius:10px;background:${bg};display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:13px;flex-shrink:0;">${ini}</div>
            <div class="flex-1">
              <div class="text-14 font-bold">${club.nombre}</div>
              <div class="text-12 text-muted">${club.ciudad||'â€”'}</div>
            </div>
            ${isAdmin?`
              <button class="btn-outline" style="padding:5px 12px;font-size:12px;" onclick="openModalClub('${club.id}')">âœï¸ Editar</button>
              <button class="btn-danger" onclick="deleteClub('${club.id}','${club.nombre}')">Eliminar</button>
            `:''}
          </div>
        </div>`}).join('')}
    </div>
  `;
}

function openModalClub(clubId=null){
  editingClubId=clubId;
  document.getElementById('modalClubError').style.display='none';
  if(clubId){
    document.getElementById('modalClubTitle').textContent='Editar Club';
    const club=STATE.clubes.find(c=>c.id===clubId);
    if(club){
      document.getElementById('clubNombre').value=club.nombre||'';
      document.getElementById('clubCiudad').value=club.ciudad||'';
      document.getElementById('clubIniciales').value=club.iniciales||'';
      document.getElementById('clubColor').value=club.color||'#2E7D5E';
    }
  } else {
    document.getElementById('modalClubTitle').textContent='Nuevo Club';
    document.getElementById('clubNombre').value='';
    document.getElementById('clubCiudad').value='';
    document.getElementById('clubIniciales').value='';
    document.getElementById('clubColor').value='#2E7D5E';
  }
  document.getElementById('modalClub').style.display='flex';
}

function closeModalClub(){ document.getElementById('modalClub').style.display='none'; editingClubId=null; }

async function saveClub(){
  const nombre=document.getElementById('clubNombre').value.trim();
  const ciudad=document.getElementById('clubCiudad').value.trim();
  const iniciales=document.getElementById('clubIniciales').value.trim().toUpperCase().slice(0,3);
  const color=document.getElementById('clubColor').value;
  const err=document.getElementById('modalClubError');
  const btn=document.getElementById('btnGuardarClub');
  if(!nombre){err.textContent='El nombre es obligatorio.';err.style.display='block';return;}
  btn.disabled=true; btn.textContent='Guardando...';
  try{
    const ini=iniciales||nombre.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,3);
    if(editingClubId){
      await db.collection('clubes').doc(editingClubId).update({nombre,ciudad,iniciales:ini,color,updated_at:firebase.firestore.FieldValue.serverTimestamp()});
    } else {
      await db.collection('clubes').add({nombre,ciudad,iniciales:ini,color,creado:firebase.firestore.FieldValue.serverTimestamp()});
    }
    closeModalClub();
  }catch(e){err.textContent='Error: '+e.message;err.style.display='block';}
  finally{btn.disabled=false;btn.textContent='Guardar Club';}
}

async function deleteClub(id,nombre){
  if(!confirm(`Â¿Eliminar el club "${nombre}"?`))return;
  await db.collection('clubes').doc(id).delete();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CARGAR RESULTADOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let cargarEntries=[];

function renderCargar(){
  const el=document.getElementById('tab-cargar');
  const jornadaId=STATE.cargarJornadaId;
  const jornada=STATE.jornadas.find(j=>j.id===jornadaId);
  if(!jornada){el.innerHTML='<p style="color:var(--muted);padding:20px;">Jornada no encontrada.</p>';return;}

  const existentes=STATE.resultados.filter(r=>r.jornada_id===jornadaId);
  if(cargarEntries.length===0||cargarEntries[0]?._jid!==jornadaId){
    cargarEntries=STATE.jugadores.map((j,i)=>{
      const ex=existentes.find(r=>r.jugador_id===j.id);
      return{_jid:jornadaId,jugador_id:j.id,jugador:j,pos:ex?.pos??(i+1),pts:ex?.pts??1,asistencia:ex?.asistencia??true};
    });
  }

  el.innerHTML=`
    <div class="flex items-center gap-8 mb-16">
      <button class="btn-back" onclick="backFromCargar()">â†</button>
      <div>
        <div class="text-15 font-bold font-georgia">${jornada.sede} â€” ${fmtFecha(jornada.fecha)}</div>
        <div class="text-12 text-muted">${badgeHTML(jornada.estado)}</div>
      </div>
    </div>

    <div class="info-attest">âœï¸ <strong>Flujo:</strong> TÃº cargas â†’ otro jugador confirma (Attest) â†’ Admin aprueba como Oficial.</div>

    <div class="card mb-16">
      <div class="card-header"><span class="card-title">Resultados</span><span class="text-11 text-muted">Puntos automÃ¡ticos por posiciÃ³n</span></div>
      ${cargarEntries.map(e=>`
        <div class="cargar-row">
          ${avatarHTML(e.jugador.foto,99,'sm')}
          <div style="flex:1;min-width:100px;">
            <div class="text-13 font-bold">${e.jugador.nombre}</div>
            <div class="text-11 text-muted">${e.jugador.alias||''}</div>
          </div>
          <label style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted);cursor:pointer;">
            <input type="checkbox" class="form-check" ${e.asistencia?'checked':''} onchange="updateEntry('${e.jugador_id}','asistencia',this.checked)"/>JugÃ³
          </label>
          <div style="display:flex;align-items:center;gap:6px;">
            <span class="text-11 text-muted">Pos.</span>
            <select class="form-select" ${!e.asistencia?'disabled':''} onchange="updateEntry('${e.jugador_id}','pos',parseInt(this.value))">
              ${STATE.jugadores.map((_,pi)=>`<option value="${pi+1}" ${e.pos===pi+1?'selected':''}>${pi+1}Â°</option>`).join('')}
            </select>
          </div>
          <div class="pts-box" style="background:${e.asistencia?(e.pos===1?'var(--goldPale)':'var(--greenPale)'):'var(--bg)'};color:${e.asistencia?(e.pos===1?'var(--gold)':'var(--green)'):'var(--muted)'};">
            ${e.pts}
          </div>
        </div>`).join('')}
    </div>

    <div id="cargarError" class="error-box" style="display:none;"></div>
    <button class="btn-save" id="btnSave" onclick="saveResultados()">ğŸ’¾ Guardar y Enviar a Attest</button>
  `;
}

function updateEntry(jugadorId,field,value){
  const e=cargarEntries.find(e=>e.jugador_id===jugadorId);
  if(!e)return;
  e[field]=value;
  if(field==='pos'||field==='asistencia') e.pts=getPts(field==='pos'?value:e.pos,field==='asistencia'?value:e.asistencia);
  renderCargar();
}

async function saveResultados(){
  const jornadaId=STATE.cargarJornadaId;
  const btn=document.getElementById('btnSave');
  const err=document.getElementById('cargarError');
  err.style.display='none'; btn.disabled=true; btn.textContent='Guardando...';
  try{
    const batch=db.batch();
    cargarEntries.forEach(e=>{
      batch.set(db.collection('resultados').doc(`${jornadaId}_${e.jugador_id}`),{
        jornada_id:jornadaId,jugador_id:e.jugador_id,pos:e.pos,pts:e.pts,asistencia:e.asistencia,
        cargado_por:STATE.profile?.jugador_id||STATE.user?.email,
        updated_at:firebase.firestore.FieldValue.serverTimestamp()
      });
    });
    batch.update(db.collection('jornadas').doc(jornadaId),{
      estado:'Pendiente Attest',cargado_por:STATE.profile?.jugador_id||null,
      cargado_at:firebase.firestore.FieldValue.serverTimestamp()
    });
    await batch.commit();
    cargarEntries=[];
    document.getElementById('tab-cargar').innerHTML=`
      <div class="success-box">
        <div style="font-size:48px;margin-bottom:14px;">âœ…</div>
        <div style="color:var(--green);font-size:18px;font-weight:700;">Â¡Resultados guardados!</div>
        <div style="color:var(--muted);font-size:13px;margin-top:8px;">Pendiente de Attest por otro jugador.</div>
        <button class="btn-primary" style="margin-top:20px;" onclick="backFromCargar()">â† Volver a Jornadas</button>
      </div>`;
  }catch(e){
    err.textContent='Error: '+e.message; err.style.display='block';
    btn.disabled=false; btn.textContent='ğŸ’¾ Guardar y Enviar a Attest';
  }
}
function backFromCargar(){ cargarEntries=[]; goTab('jornadas'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JUGADORES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let showAddJugador=false;
let editingJugadorId=null;

function renderJugadores(){
  const el=document.getElementById('tab-jugadores');
  const isAdmin=STATE.profile?.role==='admin';
  const myJugadorId=STATE.profile?.jugador_id;

  el.innerHTML=`
    ${isAdmin?`
      <button class="btn-green mb-16" onclick="toggleAddJugador()">${showAddJugador?'âœ• Cancelar':'+ Agregar Jugador'}</button>
      ${showAddJugador?`
        <div class="card mb-16">
          <div class="card-header"><span class="card-title">Nuevo Jugador</span></div>
          <div class="card-body" style="display:flex;flex-direction:column;gap:12px;">
            <div><label class="form-label">Nombre Completo *</label><input class="form-input" id="newNombre" placeholder="Ej: Daniel Badell"/></div>
            <div style="display:flex;gap:12px;">
              <div style="flex:1;"><label class="form-label">Alias</label><input class="form-input" id="newAlias" placeholder="Ej: Badell"/></div>
              <div style="width:90px;"><label class="form-label">Iniciales</label><input class="form-input" id="newFoto" placeholder="DB" maxlength="2"/></div>
            </div>
            <div>
              <label class="form-label">TelÃ©fono / WhatsApp</label>
              <div style="display:flex;gap:8px;align-items:center;">
                <select class="form-select" id="newPaisCodigo" style="width:110px;">
                  <option value="+58">ğŸ‡»ğŸ‡ª +58</option>
                  <option value="+1">ğŸ‡ºğŸ‡¸ +1</option>
                  <option value="+34">ğŸ‡ªğŸ‡¸ +34</option>
                  <option value="+52">ğŸ‡²ğŸ‡½ +52</option>
                  <option value="+57">ğŸ‡¨ğŸ‡´ +57</option>
                  <option value="+51">ğŸ‡µğŸ‡ª +51</option>
                  <option value="+54">ğŸ‡¦ğŸ‡· +54</option>
                  <option value="+56">ğŸ‡¨ğŸ‡± +56</option>
                  <option value="+55">ğŸ‡§ğŸ‡· +55</option>
                  <option value="+507">ğŸ‡µğŸ‡¦ +507</option>
                </select>
                <input class="form-input" id="newTelefono" type="tel" placeholder="4141234567" style="flex:1;" oninput="validarTelefonoNew(this)"/>
              </div>
              <div id="newTelefonoHint" style="font-size:11px;color:var(--muted);margin-top:4px;">Opcional Â· Solo nÃºmeros, sin espacios ni guiones</div>
            </div>
            <div id="addJugadorError" class="error-box" style="display:none;"></div>
            <button class="btn-green" onclick="addJugador()">Agregar al Club</button>
          </div>
        </div>`:''}
    `:''}
    <div style="display:flex;flex-direction:column;gap:10px;">
      ${STATE.jugadores.map(j=>{
        const canEdit=isAdmin||(myJugadorId===j.id);
        const rk=calcRanking().find(r=>r.id===j.id);
        return`
        <div class="card" style="margin-bottom:0;">
          <div style="padding:14px 18px;display:flex;align-items:center;gap:14px;">
            ${avatarHTML(j.foto,rk?.pos||99,'lg')}
            <div class="flex-1">
              <div class="text-14 font-bold">${j.nombre}</div>
              <div class="text-12 text-muted">${j.alias||'â€”'}${j.handicap!==undefined?' Â· HCP '+j.handicap:''}</div>
              ${j.telefonoCompleto?`<div class="text-11 text-muted" style="margin-top:2px;">ğŸ“± ${j.telefonoCompleto}</div>`:``}
            </div>
            <div style="text-align:right;min-width:40px;">
              <div style="font-size:18px;font-weight:800;color:${rk?.pos===1?'var(--gold)':'var(--text)'};">${rk?.ptsT||0}</div>
              <div class="text-10 text-muted">pts</div>
            </div>
            ${canEdit?`<button class="btn-outline" style="padding:5px 12px;font-size:12px;" onclick="openModalJugador('${j.id}')">âœï¸</button>`:''}
            ${isAdmin?`<button class="btn-danger" onclick="deleteJugador('${j.id}','${j.nombre}')">Eliminar</button>`:''}
          </div>
        </div>`;}).join('')}
    </div>
  `;
}

function toggleAddJugador(){ showAddJugador=!showAddJugador; renderJugadores(); }

function openModalJugador(jugadorId){
  editingJugadorId=jugadorId;
  document.getElementById('modalJugadorError').style.display='none';
  const j=STATE.jugadores.find(j=>j.id===jugadorId);
  if(j){
    document.getElementById('editNombre').value=j.nombre||'';
    document.getElementById('editAlias').value=j.alias||'';
    document.getElementById('editFoto').value=j.foto||'';
    document.getElementById('editHandicap').value=j.handicap??'';
    const tel=j.telefono||'';
    const codigoPais=j.codigoPais||'+58';
    document.getElementById('editPaisCodigo').value=codigoPais;
    document.getElementById('editTelefono').value=tel;
    document.getElementById('telefonoHint').textContent='Solo nÃºmeros, sin espacios ni guiones. Ej: 4141234567';
    document.getElementById('telefonoHint').style.color='var(--muted)';
  }
  document.getElementById('modalJugador').style.display='flex';
}

function closeModalJugador(){ document.getElementById('modalJugador').style.display='none'; editingJugadorId=null; }

function validarFormatoTel(num, codigo){
  // Min 7 digits, max 15 (E.164 standard minus country code)
  if(!/^\d{7,15}$/.test(num)) return false;
  // Venezuela: must start with 04 or 02, 10 digits total
  if(codigo==='+58') return /^(04|02)\d{8}$/.test(num);
  return num.length>=7&&num.length<=15;
}

function validarTelefonoNew(input){
  const hint=document.getElementById('newTelefonoHint');
  const codigo=document.getElementById('newPaisCodigo').value;
  const val=input.value.replace(/\D/g,'');
  input.value=val;
  if(!val){hint.textContent='Opcional Â· Solo nÃºmeros, sin espacios ni guiones';hint.style.color='var(--muted)';return;}
  if(validarFormatoTel(val,codigo)){
    hint.textContent='âœ… Formato vÃ¡lido Â· '+codigo+val;
    hint.style.color='var(--green)';
    input.style.borderColor='var(--green)';
  } else {
    const tip=codigo==='+58'?'Venezuela: debe empezar con 04xx o 02xx, 10 dÃ­gitos':'Entre 7 y 15 dÃ­gitos numÃ©ricos';
    hint.textContent='âš ï¸ '+tip;
    hint.style.color='var(--red)';
    input.style.borderColor='var(--red)';
  }
}

function validarTelefono(input){
  const hint=document.getElementById('telefonoHint');
  const codigo=document.getElementById('editPaisCodigo').value;
  const val=input.value.replace(/\D/g,'');
  input.value=val; // strip non-digits live
  if(!val){hint.textContent='Solo nÃºmeros, sin espacios ni guiones. Ej: 4141234567';hint.style.color='var(--muted)';return;}
  if(validarFormatoTel(val,codigo)){
    hint.textContent='âœ… Formato vÃ¡lido Â· '+codigo+val;
    hint.style.color='var(--green)';
    input.style.borderColor='var(--green)';
  } else {
    const tip=codigo==='+58'?'Venezuela: debe empezar con 04xx o 02xx, 10 dÃ­gitos':'Entre 7 y 15 dÃ­gitos numÃ©ricos';
    hint.textContent='âš ï¸ '+tip;
    hint.style.color='var(--red)';
    input.style.borderColor='var(--red)';
  }
}

async function saveJugador(){
  const nombre=document.getElementById('editNombre').value.trim();
  const alias=document.getElementById('editAlias').value.trim();
  const foto=document.getElementById('editFoto').value.trim().toUpperCase().slice(0,2);
  const handicap=document.getElementById('editHandicap').value;
  const telefono=document.getElementById('editTelefono').value.trim().replace(/\D/g,'');
  const codigoPais=document.getElementById('editPaisCodigo').value;
  const err=document.getElementById('modalJugadorError');
  // Validate phone
  if(telefono&&!validarFormatoTel(telefono,codigoPais)){
    err.textContent='Formato de telÃ©fono invÃ¡lido. Solo nÃºmeros, entre 7 y 15 dÃ­gitos.';
    err.style.display='block';return;
  }
  const btn=document.getElementById('btnGuardarJugador');
  if(!nombre){err.textContent='El nombre es obligatorio.';err.style.display='block';return;}
  btn.disabled=true; btn.textContent='Guardando...';
  try{
    const upd={nombre,alias:alias||nombre.split(' ')[0],foto:foto||nombre.split(' ').map(n=>n[0]).join('').toUpperCase().slice(0,2),updated_at:firebase.firestore.FieldValue.serverTimestamp()};
    if(handicap!=='')upd.handicap=Number(handicap);
    if(telefono){upd.telefono=telefono;upd.codigoPais=codigoPais;upd.telefonoCompleto=codigoPais+telefono;}
    await db.collection('jugadores').doc(editingJugadorId).update(upd);
    closeModalJugador();
  }catch(e){err.textContent='Error: '+e.message;err.style.display='block';}
  finally{btn.disabled=false;btn.textContent='Guardar';}
}

async function addJugador(){
  const nombre=document.getElementById('newNombre').value.trim();
  const alias=document.getElementById('newAlias').value.trim();
  const foto=document.getElementById('newFoto').value.trim().toUpperCase().slice(0,2);
  const telefono=document.getElementById('newTelefono').value.trim().replace(/\D/g,'');
  const codigoPais=document.getElementById('newPaisCodigo').value;
  const err=document.getElementById('addJugadorError');
  if(!nombre){err.textContent='El nombre es obligatorio.';err.style.display='block';return;}
  if(telefono&&!validarFormatoTel(telefono,codigoPais)){
    err.textContent='Formato de telÃ©fono invÃ¡lido.';err.style.display='block';return;
  }
  const initials=foto||nombre.split(' ').map(n=>n[0]).join('').toUpperCase().slice(0,2);
  const id=nombre.toLowerCase().replace(/\s+/g,'_')+'_'+Date.now();
  const data={nombre,alias:alias||nombre.split(' ')[0],foto:initials,creado:firebase.firestore.FieldValue.serverTimestamp()};
  if(telefono){data.telefono=telefono;data.codigoPais=codigoPais;data.telefonoCompleto=codigoPais+telefono;}
  await db.collection('jugadores').doc(id).set(data);
  showAddJugador=false;
}

async function deleteJugador(id,nombre){
  if(!confirm(`Â¿Eliminar a ${nombre}?`))return;
  await db.collection('jugadores').doc(id).delete();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function seedDatos(){
  const msg=document.getElementById('seedMsg');
  msg.style.display='block'; msg.textContent='â³ Cargando datos iniciales...';
  try{
    const batch=db.batch();
    batch.set(db.collection('torneos').doc('apertura2026'),{nombre:'Torneo Apertura 2026',estado:'Activo',jornadas_total:8,temporada:'2026',creado:firebase.firestore.FieldValue.serverTimestamp()});
    [
      {id:'badell',nombre:'Daniel Badell',alias:'Badell',foto:'DB'},
      {id:'jimeno',nombre:'Javi Jimeno',alias:'Jimeno',foto:'JJ'},
      {id:'padron',nombre:'Loor PadrÃ³n',alias:'Loor',foto:'LP'},
      {id:'kolman',nombre:'Juan Kolman',alias:'Kolman',foto:'JK'},
      {id:'aguiar',nombre:'JesÃºs Aguiar',alias:'J. Aguiar',foto:'JA'},
      {id:'soto',nombre:'Mauricio Soto',alias:'Soto',foto:'MS'},
      {id:'aguiar_r',nombre:'JesÃºs Aguiar Romero',alias:'Aguiar R.',foto:'JR'},
    ].forEach(j=>{const{id,...d}=j;batch.set(db.collection('jugadores').doc(id),{...d,creado:firebase.firestore.FieldValue.serverTimestamp()});});
    await batch.commit();
    const clubesSeed=[
      {nombre:'Izcaragua Country Club',ciudad:'Caracas'},
      {nombre:'Junko Golf Club',ciudad:'Caracas'},
      {nombre:'Lagunita Country Club',ciudad:'Caracas'},
      {nombre:'Valle Arriba Golf Club',ciudad:'Caracas'},
      {nombre:'Guataparo Country Club',ciudad:'Valencia'},
    ];
    for(const c of clubesSeed){
      await db.collection('clubes').add({...c,creado:firebase.firestore.FieldValue.serverTimestamp()});
    }
    msg.textContent='âœ… Â¡Datos cargados! Jugadores, jornadas y clubes creados.';
  }catch(e){ msg.style.color='var(--red)'; msg.textContent='âŒ Error: '+e.message; }
}
</script>
</body>
</html>
